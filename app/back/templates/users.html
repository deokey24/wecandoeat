{% extends "base.html" %}

{% block title %}ê³„ì • ê¶Œí•œ ê´€ë¦¬ | ê´€ë¦¬ì{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-8">
  <h1 class="text-2xl font-bold mb-6">ê³„ì • ê¶Œí•œ ê´€ë¦¬</h1>

  <div class="bg-white shadow rounded-xl overflow-hidden">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-100">
        <tr>
          <th class="px-4 py-2 text-left">ID</th>
          <th class="px-4 py-2 text-left">ì´ë¦„</th>   {# ğŸ”¥ ì¶”ê°€ #}
          <th class="px-4 py-2 text-left">ì•„ì´ë””</th>
          <th class="px-4 py-2 text-left">í˜„ì¬ ì—­í• </th>
          <th class="px-4 py-2 text-left">ë³€ê²½</th>
        </tr>
      </thead>
      <tbody>

        {% for u in users %}
          <tr class="border-t">
            <td class="px-4 py-2">{{ u.id }}</td>

            <!-- ğŸ”¥ ì‹¤ëª… í‘œì‹œ -->
            <td class="px-4 py-2">{{ u.name }}</td>

            <td class="px-4 py-2">{{ u.username }}</td>

            <!-- ì—­í• ëª… í‘œì‹œ -->
            <td class="px-4 py-2">
              {% if role_labels.get(u.role) %}
                {{ role_labels[u.role] }}
              {% else %}
                {# ğŸ”¥ role>=2 ì´ë©´ ì§€ì  ì´ë¦„ í‘œì‹œ #}
                {% set matched_store = None %}
                {% for s in stores %}
                  {% if s.role == u.role %}
                    {% set matched_store = s %}
                  {% endif %}
                {% endfor %}
                
                {% if matched_store %}
                  ì§€ì ê´€ë¦¬ì ({{ matched_store.name }})
                {% else %}
                  ì§€ì ê´€ë¦¬ì ({{ u.role }})
                {% endif %}
              {% endif %}
            </td>

            <!-- ì—­í•  ë³€ê²½ ì„ íƒ -->
            <td class="px-4 py-2">
              <form method="post" action="/users/{{ u.id }}/role" class="flex items-center gap-2">
                <select name="new_role" class="border px-2 py-1 rounded">

                  <!-- ê¸°ë³¸ ì—­í•  -->
                  <option value="0" {% if u.role == 0 %}selected{% endif %}>ê°€ì…ëŒ€ê¸°ì¤‘ (0)</option>
                  <option value="1" {% if u.role == 1 %}selected{% endif %}>ì „ì²´ê´€ë¦¬ì (1)</option>

                  <optgroup label="ê° ì§€ì ëª©ë¡">
                    {% for s in stores %}
                      <option value="{{ s.role }}" {% if u.role == s.role %}selected{% endif %}>
                        {{ s.name }} ({{ s.role }})
                      </option>
                    {% endfor %}
                  </optgroup>

                </select>

                <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium px-3 py-1 rounded-lg">
                  ì €ì¥
                </button>
              </form>
            </td>

          </tr>
        {% endfor %}

      </tbody>
    </table>
  </div>
</div>
{% endblock %}
